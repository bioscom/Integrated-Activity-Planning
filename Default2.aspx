<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default2.aspx.cs" Inherits="Default2" %>

<%--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>IAP Request</title>
    <style type="text/css">
        .auto-style1 {
            color: #FF0000;
        }
    </style>
    </head>
<body>
    <br/>
    Dear Sir/Ma, <br/><br/>
	<span class="auto-style1">
	<strong>This is system autogenerated email.</strong></span><br/><br/>
	You have the following IAP Change Request(s) Pending your action.<br/>
    @@REPORTING
	<br/>
    <br />
    Click <a href=@@URL> here </a> to login.<br/>

    <br />
    <div>
        For help and assistance, please contact @SSSADMIN
        on ext. @@EXT or @@EMAIL
    </div>
            
</body>
</html>--%>

<%--<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1" />
    <title> - Bonga Commitment Control</title>

    <!-- Script -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="/js/bootstrap-datepicker.js"></script>
    <script src="/js/jquery.dataTables.min.js"></script>
    <script src="/js/dataTables.bootstrap4.min.js"></script>
    <script src="/js/accounting.min.js"></script>
    <script src="/js/moment.min.js"></script>
    <script src="/js/select2.full.min.js" type="text/javascript"></script>
    <script src="/assets/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="/js/site.js"></script>

    <!-- Script for Kendo -->
    <script src="/Kendo/js/jszip.min.js"></script>
    <script src="/Kendo/js/kendo.all.min.js"></script>
    <script src="/Kendo/js/kendo.aspnetmvc.min.js"></script>
    <script src="/Kendo/js/kendo.timezones.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
    <link href="/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="/css/responsive.bootstrap.min.css" rel="stylesheet" />
    <link href="/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="/bootstrap-datepicker.css" rel="stylesheet" />
    <link href="/css/site.css" rel="stylesheet" />

    <link href="/Kendo/styles/kendo.common.min.css" rel="stylesheet" />
    <link href="/Kendo/styles/kendo.rtl.min.css" rel="stylesheet" />
    <link href="/Kendo/styles/kendo.uniform.min.css" rel="stylesheet" />
    <link href="/Kendo/styles/kendo.uniform.mobile.min.css" rel="stylesheet" />
    <link href="//aspnet-core/shared/examples.css" rel="stylesheet" />

    
        <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
        <link rel="stylesheet" href="/css/site.css" />
    
    

</head>
<body>
    


    <nav class="navbar navbar-fixed-top" style="background-color:white">

        <a href="/Commitments/Index" class="navbar-brand">
            <img src="/images/ShellLogo.png" title="Bonga Commitment Control" alt="" />
        </a>

        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/Commitments/Index">Bonga Commitment Control</a>
            </div>

            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">

                </ul>
                
                <p class="nav navbar-text navbar-right">AFRICA-ME\Isaac.Bejide</p>
                        <p class="nav navbar-text navbar-right">Logged in as, <b style="color:darkred">Line Manager</b></p>
            </div>
        </div>
        <div style="height:30px; background-color:gold; border-top:1px solid silver"></div>
        <div style="height:7px; background-color:#D42E12; border-bottom:1px solid silver"></div>

        



<div id="DetailsViewModal" class="modal fade WideView">
    <div class="modal-dialog modal-lg" style="width:98%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4 class="modal-title">Sent for Approval</h4>
            </div>
            <div id="DetailsViewModalWrapper" class="modal-body">
                
<div class="top-buffer"></div>
<input type="hidden" id="oBudgetBookCommitment_ID" name="oBudgetBookCommitment.ID" value="" />



<div class="col-md-12 row" style="font-size:12px">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#AA">Approval Decision</a></li>
        <li><a data-toggle="tab" href="#BB">Request Details</a></li>
        <li><a data-toggle="tab" href="#CC">Cost Breakdown Details</a></li>
        <li><a data-toggle="tab" href="#DD">Attached Documents</a></li>
    </ul>
    <div class="tab-content" style="border-bottom:1px solid silver; border-left:1px solid silver; border-right:1px solid silver">
        <div id="AA" class="tab-pane fade in active">
            <div class="panel-body">
                


<input type="hidden" id="oBudgetBookCommitment_ID" name="oBudgetBookCommitment.ID" value="" />

<div class="form-group row">
    <div class="col-md-2 pull-left">
        <label class="control-label" for="oBudgetBookCommitment_ApproverID">Approved By</label>
    </div>
    <div class="col-md-10 pull-left">
        
    </div>
</div>

<div class="form-group row">
    <div class="col-md-2">
        <b>Comments:</b>
    </div>
    <div class="col-md-10">
        
    </div>
</div>

<div class="form-group row">
    <div class="col-md-7">
        <div class="col-md-3">
            <label class="control-label" for="oBudgetBookCommitment_ApprovalID">Stand:</label>
        </div>
        <div class="col-md-9">
            
        </div>
    </div>
    <div class="col-md-5">
        <div class="col-md-7">
            <label class="control-label" for="oBudgetBookCommitment_Savings">Savings</label>($):
        </div>
        <div class="col-md-5">
            
        </div>
    </div>
</div>


            </div>
        </div>
        <div id="BB" class="tab-pane fade">
            <div class="panel-body">
                
<input type="hidden" id="oBudgetBook_ID" name="oBudgetBook.ID" value="" />
<input type="hidden" data-val="true" data-val-required="The Activity Code field is required." id="oBudgetBook_ActivityCodeID" name="oBudgetBook.ActivityCodeID" value="" />


            </div>
        </div>
        <div id="CC" class="tab-pane fade">
            <div class="panel-body">
                
<table class="table-striped table-bordered table-hover" style="width:100%">
    <thead>
        <tr>
            <th>S/No.</th>
            <th>
                Activity
            </th>
            <th>
                Currency
            </th>
            <th>
                Qty
            </th>
            <th>
                Rate
            </th>
            <th>
                &#8358; Fixed Rate
            </th>
            <th>
                Amount(F'$)
            </th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
            <tr>
                <th>

                </th>
                <td>
                    <b>
                        Total
                    </b>
                </td>
                <td></td>
                <td colspan="4">
                    <div class="pull-right">
                        <b>
                            0.00
                        </b>
                    </div>
                </td>
            </tr>
    </tfoot>
</table>

            </div>
        </div>
        <div id="DD" class="tab-pane fade">
            <div class="panel-body">
                

<table class="table table-condensed table-hover table-bordered" style="font-size:12px">
    <thead>
        <tr>
            <th>
                Title
            </th>
            <th>
                File Name
            </th>
            <th>
                Date Uploaded
            </th>
            <th class="text-center">
                File Upload Size (KByte)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="3">
                <b>Total File(s) upload size</b>
            </td>
            <td class="text-right">


                <b>0.00</b>
            </td>
            <td></td>
        </tr>
    </tfoot>
</table>

            </div>
        </div>
    </div>
</div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger rounded-0" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid row" style="margin-top:0.5em; border-bottom:1px solid silver">
    <div class="col-sm-2" style="text-align:center">
    </div>

    <div class="col-sm-7 pull-left">
        <form>
            <div class="form-group row">
                <div class="input-group">
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-search"></span>
                    </span>
                    <select id="ddlCloneCommitment" class="form-control selectpicker" data-live-search="true" name="oBudgetBookCommitment.ID">
                        <option value="-1" disabled selected>Search for commitment...</option>
                    <option value="4">SNEP190004 - Demo Work Flow One</option>
<option value="5">SNEP190005 - Demo test</option>
<option value="6">SNEP190006 - Demo Work Flow Two</option>
<option value="8">SNEP190007 - Testing current update</option>
<option value="1">SNEP190013 - Testing Commitment Control</option>
<option value="2">SNEP190013 - Testing application working well</option>
<option value="3">SNEP190013 - More tests need to be done to ensure quality performance</option>
<option value="14">SNEP190014 - [Cloned from SNEP190013]Testing application working well</option>
<option value="17">SNEP190015 - Testing once again</option>
<option value="19">SNEP190018 - Introducing prompt if the value request is greater than NAPIMS approved budget.</option>
<option value="20">SNEP200020 - Further Testing of this application</option>
<option value="21">SNEP200021 - Testing database changessssss</option>
<option value="22">SNEP200022 - Solving more and more teething issues</option>
<option value="23">SNEP200023 - Further testing</option>
<option value="24">SNEP200024 - Another test</option>
<option value="25">SNEP200025 - Testing application removing errorsssssss</option>
<option value="26">SNEP200026 - [Cloned from SNEP200025]Testing application removing errorsssssss</option>
</select>
                </div>
            </div>
        </form>
    </div>

    <div class="col-sm-3 pull-right">
        <b>Monthly Exchange Rate: </b> <b style="color:darkred; text-underline-position:below">&#8358;360.50 - $1 [May]</b>
    </div>
</div>

<script>
    //TODO: Source: https://stackoverflow.com/questions/4078553/ajax-call-on-onchange-event-in-mvc
    //https://weblog.west-wind.com/posts/2016/sep/14/bootstrap-modal-dialog-showing-under-modal-background
    $("#ddlCloneCommitment").change( function (event) {
        var mymodal = $("#DetailsViewModal");
        $.ajax({
            url: '/Commitments/ViewCommitmentDetails/' + $(this).val(), 
            success: function (data) {
                $('#DetailsViewModalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
                mymodal.modal("show");
                mymodal.appendTo("body"); 
            }
        });
    });

</script>

    </nav>


    



    <div id="wrap">
        <div id="main" class="container-fluid body-content" style="margin-top:10.6em;">
            <div class="row">
                <div class="col-md-12">
                    



<div id="approvedModal" class="modal fade WideView">
    <div class="modal-dialog" style="width:50%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4 class="modal-title">Approved Commitment Control</h4>
            </div>
            <div id="approvedModalWrapper" class="modal-body">
                
<div class="top-buffer"></div>
<input type="hidden" id="oBudgetBookCommitment_ID" name="oBudgetBookCommitment.ID" value="" />



<div class="col-md-12 row" style="font-size:12px">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#AA">Approval Decision</a></li>
        <li><a data-toggle="tab" href="#BB">Request Details</a></li>
        <li><a data-toggle="tab" href="#CC">Cost Breakdown Details</a></li>
        <li><a data-toggle="tab" href="#DD">Attached Documents</a></li>
    </ul>
    <div class="tab-content" style="border-bottom:1px solid silver; border-left:1px solid silver; border-right:1px solid silver">
        <div id="AA" class="tab-pane fade in active">
            <div class="panel-body">
                


<input type="hidden" id="oBudgetBookCommitment_ID" name="oBudgetBookCommitment.ID" value="" />

<div class="form-group row">
    <div class="col-md-2 pull-left">
        <label class="control-label" for="oBudgetBookCommitment_ApproverID">Approved By</label>
    </div>
    <div class="col-md-10 pull-left">
        
    </div>
</div>

<div class="form-group row">
    <div class="col-md-2">
        <b>Comments:</b>
    </div>
    <div class="col-md-10">
        
    </div>
</div>

<div class="form-group row">
    <div class="col-md-7">
        <div class="col-md-3">
            <label class="control-label" for="oBudgetBookCommitment_ApprovalID">Stand:</label>
        </div>
        <div class="col-md-9">
            
        </div>
    </div>
    <div class="col-md-5">
        <div class="col-md-7">
            <label class="control-label" for="oBudgetBookCommitment_Savings">Savings</label>($):
        </div>
        <div class="col-md-5">
            
        </div>
    </div>
</div>


            </div>
        </div>
        <div id="BB" class="tab-pane fade">
            <div class="panel-body">
                
<input type="hidden" id="oBudgetBook_ID" name="oBudgetBook.ID" value="" />
<input type="hidden" data-val="true" data-val-required="The Activity Code field is required." id="oBudgetBook_ActivityCodeID" name="oBudgetBook.ActivityCodeID" value="" />


            </div>
        </div>
        <div id="CC" class="tab-pane fade">
            <div class="panel-body">
                
<table class="table-striped table-bordered table-hover" style="width:100%">
    <thead>
        <tr>
            <th>S/No.</th>
            <th>
                Activity
            </th>
            <th>
                Currency
            </th>
            <th>
                Qty
            </th>
            <th>
                Rate
            </th>
            <th>
                &#8358; Fixed Rate
            </th>
            <th>
                Amount(F'$)
            </th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
            <tr>
                <th>

                </th>
                <td>
                    <b>
                        Total
                    </b>
                </td>
                <td></td>
                <td colspan="4">
                    <div class="pull-right">
                        <b>
                            0.00
                        </b>
                    </div>
                </td>
            </tr>
    </tfoot>
</table>

            </div>
        </div>
        <div id="DD" class="tab-pane fade">
            <div class="panel-body">
                

<table class="table table-condensed table-hover table-bordered" style="font-size:12px">
    <thead>
        <tr>
            <th>
                Title
            </th>
            <th>
                File Name
            </th>
            <th>
                Date Uploaded
            </th>
            <th class="text-center">
                File Upload Size (KByte)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="3">
                <b>Total File(s) upload size</b>
            </td>
            <td class="text-right">


                <b>0.00</b>
            </td>
            <td></td>
        </tr>
    </tfoot>
</table>

            </div>
        </div>
    </div>
</div>
            </div>
        </div>
    </div>
</div>

<div id="detailsModal" class="modal fade WideView">
    <div class="modal-dialog" style="width:50%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4 class="modal-title">Line Manager's Review</h4>
            </div>
            <form id="iFormActionCommitment" action="/Commitments/LineManagerApproval" method="post">
                <div id="detailsModalWrapper" class="modal-body">
                </div>
            <input name="__RequestVerificationToken" type="hidden" value="CfDJ8OXnQUW7pHtDlfsEXKtkjhoJvka16wwM0vQAQ2grYY51MMoQlBbhb8f40bRKeg46Ogfp0HnItvnambPRnsnz3o23d-VUOo88jiib2I6uoRr2TtvxyIDExJG2AuNaI537wpc8lz7Uri9IkbdE2iIK6tLp_ED8LEwu2rv0_tteJ9y93ae_p0hHwKMZqzaq33OPcw" /></form>
        </div>
    </div>
</div>

<div id="declineModal" class="modal fade WideView">
    <div class="modal-dialog" style="width:50%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4 class="modal-title">Line Manager's Review (CC Panel)</h4>
            </div>
            <form id="iFormDecline" action="/Commitments/LineManagerDeclined" method="post">
                <div id="declineModalWrapper" class="modal-body">
                </div>
            <input name="__RequestVerificationToken" type="hidden" value="CfDJ8OXnQUW7pHtDlfsEXKtkjhoJvka16wwM0vQAQ2grYY51MMoQlBbhb8f40bRKeg46Ogfp0HnItvnambPRnsnz3o23d-VUOo88jiib2I6uoRr2TtvxyIDExJG2AuNaI537wpc8lz7Uri9IkbdE2iIK6tLp_ED8LEwu2rv0_tteJ9y93ae_p0hHwKMZqzaq33OPcw" /></form>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-2">
        <div class="form-group">
            <label class="control-label">Handover to alternate:</label>
        </div>
    </div>
    <div class="col-md-3">
        <div class="form-group">
            <select id="ddlUser" class="form-control">
                <option>--- Select Alternate ---</option>
            <option value="171">Akinyemi, Oluwaseun</option>
<option value="175">Ejiofor, Chiedu</option>
<option value="1">Isaac Bejide</option>
<option value="172">Jonathan, Amakiri</option>
<option value="174">Lusquinos, Carlos</option>
<option value="170">van Duuren, Jillis</option>
<option value="169">Victor Bejide</option>
</select>
        </div>
    </div>
    <div class="col-md-1">
        <div class="form-group">
            <button id="HandOver" type="button" class="btn btn-google-plus rounded-0">Handover to Alternate</button>
        </div>
    </div>
</div>

<div class="col-md-12 row">
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#sectionA">Commitments Pending My Review</a></li>
        <li><a data-toggle="tab" href="#sectionB">Approved Commitment Control</a></li>
        <li><a data-toggle="tab" href="#sectionC">Rejected/Modified Commitment Control</a></li>
        <li><a data-toggle="tab" href="#sectionD">Sent For Commitment Controls Panel Review</a></li>
    </ul>
    <div class="tab-content" style="border-bottom:1px solid silver; border-left:1px solid silver; border-right:1px solid silver">
        <div id="sectionA" class="tab-pane fade in active">
            
<div class="container-fluid"  style="overflow:auto">
    <br />
    <div style="width:100%; margin:0 auto;">
        <table id="LMPendingBudgets" class="table table-striped table-bordered dt-responsive" style="font-size:11px;width:100%" cellspacing="0">
            <thead>
                <tr>
                    <th>S/No</th>
                    <th></th>
                    <th>
                        BCC No.
                    </th>
                    <th>
                        Activity Description
                    </th>
                    <th>
                        Status
                    </th>
                    <th>
                        Commitment(F$)
                    </th>
                    <th>
                        Capex / Opex
                    </th>
                    <th>
                        Direct / Allocated
                    </th>
                    <th>
                        UAP Code
                    </th>
                    <th>
                        UAP Roll Up Code
                    </th>
                    <th>
                        Activity Name
                    </th>
                    <th>
                        Activity Code
                    </th>
                    <th>
                        Cost Object
                    </th>
                    <th>
                        Activity
                    </th>
                    <th>
                        Focal Point
                    </th>
                    <th>
                        Activity Owner
                    </th>
                    <th>
                        Accountable Manager
                    </th>
                    <th>
                        Contract
                    </th>
                    <th>
                        Line Manager
                    </th>
                    
                </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript">

    var Threshold = 80000;

    $(document).ready(function ()
    {
        $("#LMPendingBudgets").DataTable({
            "aLengthMenu": [[25, 50, 75, -1], [25, 50, 75, "All"]],
            "iDisplayLength": 25,

            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "/Commitments/LoadLMPendingCommitments",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs":
            [{
                "width": "30%", "targets": [3],
                "targets": [5], "className": "right",
                "render": $.fn.dataTable.render.number(',', '.', 2),
                //"visible": false,
                "searchable": false
            }],
            "columns":[
                {
                    "data": "id",
                    render: function (data, type, row, meta) { return meta.row + meta.settings._iDisplayStart + 1; },
                    "autoWidth": true
                },
                {
                    "render": function (data, type, full, meta) {
                        //appSettings.Value.Threshold
                        if (full.Commitment >= Threshold) {
                            //return "<a href='#' class='btn-link btn-primary' onclick=SendForCCPanel('" + full.ID + "');>Send_for Panel_Approval</a>";
                            return "<a href='#' class='btn-link btn-primary' onclick=RejectedByLineManager('" + full.ID + "');>Send_for Panel_Approval</a>";
                            
                        }
                        else {
                            return "<a href='#' class='btn-link btn-primary' onclick=viewDetailsRow('" + full.ID + "');>Action</a>";
                        }
                    }
                },
                { "data": "Comitmntno", "name": "Comitmntno", "autoWidth": true },
                { "data": "title", "name": "title", "width":"30%" },
                {
                    "data": "sApprovalID", "name": "sApprovalID", "autoWidth": true,
                    //"data": "CCPSessionDate", "name": "CCPSessionDate", "autoWidth": true,
                    //"render": function (value) {
                    //    if (value === null) return "";
                    //    return moment(value).format('DD-MMM-YYYY');
                    //}
                },
                { "data": "Commitment", "name": "Commitment", "autoWidth": true, className: "text-right" },
                { "data": "CapexOpex", "name": "CapexOpex", "autoWidth": true },
                { "data": "sDirectAllocated", "name": "sDirectAllocated", "autoWidth": true },
                { "data": "UapCode", "name": "UapCode", "autoWidth": true },
                { "data": "UapRollUpCode", "name": "UapRollUpCode", "autoWidth": true },
                { "data": "ActivityType", "name": "ActivityType", "autoWidth": true },
                { "data": "ActivityCode", "name": "ActivityCode", "autoWidth": true },
                { "data": "CostObject", "name": "CostObject", "autoWidth": true },
                { "data": "Activity", "name": "Activity", "autoWidth": true },
                { "data": "FocalPoint", "name": "FocalPoint", "autoWidth": true },
                { "data": "ActivityOwner", "name": "ActivityOwner", "autoWidth": true },
                { "data": "Sponsor", "name": "Sponsor", "autoWidth": true },
                { "data": "Contract", "name": "Contract", "autoWidth": true },
                { "data": "LineManagerFullName", "name": "LineManagerFullName", "autoWidth": true },
            ]
        });
    });

</script>

        </div>
        <div id="sectionB" class="tab-pane fade">
            
<div class="container-fluid" style="overflow:auto">
    <br />
    <div style="width:100%; margin:0 auto;">
        <table id="LMApprovedBudgets" class="table table-striped table-bordered dt-responsive" style="font-size:11px;width:100%" cellspacing="0">
            <thead>
                <tr>
                    <th>S/No</th>
                    <th></th>
                    <th>
                        BCC No.
                    </th>
                    <th>
                        Activity Description
                    </th>
                    <th>
                        Status
                    </th>
                    <th>
                        Commitment(F$)
                    </th>
                    <th>
                        Capex / Opex
                    </th>
                    <th>
                        Direct / Allocated
                    </th>
                    <th>
                        UAP Code
                    </th>
                    <th>
                        UAP Roll Up Code
                    </th>
                    <th>
                        Activity Name
                    </th>
                    <th>
                        Activity Code
                    </th>
                    <th>
                        Cost Object
                    </th>
                    <th>
                        Activity
                    </th>
                    <th>
                        Focal Point
                    </th>
                    <th>
                        Activity Owner
                    </th>
                    <th>
                        Accountable Manager
                    </th>
                    <th>
                        Contract
                    </th>
                    <th>
                        Line Manager
                    </th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript">

   $(document).ready(function ()
    {
       $("#LMApprovedBudgets").DataTable({
            "aLengthMenu": [[25, 50, 75, -1], [25, 50, 75, "All"]],
            "iDisplayLength": 25,

            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "/Commitments/LoadLMApprovedCommitments",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs":
            [{
                "targets": [5], "className": "right",
                "render": $.fn.dataTable.render.number(',', '.', 2),
                //"visible": false,
                "searchable": false
            }],
            "columns": [
                {
                    "data": "id",
                    render: function (data, type, row, meta) { return meta.row + meta.settings._iDisplayStart + 1; },
                    "autoWidth": true
                },
                {
                    data: null, render: function (data, type, row)
                    {
                        return "<a href='#' class='btn-link btn-primary' onclick=viewApprovedDetailsRow('" + row.ID + "');>View</a>";
                    }
                },
                { "data": "Comitmntno", "name": "Comitmntno", "autoWidth": true },
                { "data": "title", "name": "title", "autoWidth": true },
                {
                    "data": "sApprovalID", "name": "sApprovalID", "autoWidth": true,
                    //"data": "CCPSessionDate", "name": "CCPSessionDate", "autoWidth": true,
                    //"render": function (value) {
                    //    if (value === null) return "";
                    //    return moment(value).format('DD-MMM-YYYY');
                    //}
                },
                { "data": "Commitment", "name": "Commitment", "autoWidth": true , className: "text-right"},
                { "data": "CapexOpex", "name": "CapexOpex", "autoWidth": true },
                { "data": "sDirectAllocated", "name": "sDirectAllocated", "autoWidth": true },
                { "data": "UapCode", "name": "UapCode", "autoWidth": true },
                { "data": "UapRollUpCode", "name": "UapRollUpCode", "autoWidth": true },
                { "data": "ActivityType", "name": "ActivityType", "autoWidth": true },
                { "data": "ActivityCode", "name": "ActivityCode", "autoWidth": true },
                { "data": "CostObject", "name": "CostObject", "autoWidth": true },
                { "data": "Activity", "name": "Activity", "autoWidth": true },
                { "data": "FocalPoint", "name": "FocalPoint", "autoWidth": true },
                { "data": "ActivityOwner", "name": "ActivityOwner", "autoWidth": true },
                { "data": "Sponsor", "name": "Sponsor", "autoWidth": true },
                { "data": "Contract", "name": "Contract", "autoWidth": true },
                { "data": "LineManagerFullName", "name": "LineManagerFullName", "autoWidth": true },
            ]
        });
   });;

</script>
        </div>
        <div id="sectionC" class="tab-pane fade">
            
<div class="container-fluid" style="overflow:auto">
    <br />
    <div style="width:100%; margin:0 auto;">
        <table id="LMRejectedBudgets" class="table table-striped table-bordered dt-responsive" style="font-size:11px;width:100%" cellspacing="0">
            <thead>
                <tr>
                    <th>S/No</th>
                    <th>
                        BCC No.
                    </th>
                    <th>
                        Activity Description
                    </th>
                    <th>
                        Status
                    </th>
                    <th>
                        Commitment(F$)
                    </th>
                    <th>
                        Capex / Opex
                    </th>
                    <th>
                        Direct / Allocated
                    </th>
                    <th>
                        UAP Code
                    </th>
                    <th>
                        UAP Roll Up Code
                    </th>
                    <th>
                        Activity Name
                    </th>
                    <th>
                        Activity Code
                    </th>
                    <th>
                        Cost Object
                    </th>
                    <th>
                        Activity
                    </th>
                    <th>
                        Focal Point
                    </th>
                    <th>
                        Activity Owner
                    </th>
                    <th>
                        Accountable Manager
                    </th>
                    <th>
                        Contract
                    </th>
                    <th>
                        Line Manager
                    </th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript">

   $(document).ready(function ()
    {
       $("#LMRejectedBudgets").DataTable({
            "aLengthMenu": [[25, 50, 75, -1], [25, 50, 75, "All"]],
            "iDisplayLength": 25,

            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "/Commitments/LoadLMRejectedCommitments",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs":
            [{
                "targets": [5], "className": "right",
                "render": $.fn.dataTable.render.number(',', '.', 2),
                //"visible": false,
                "searchable": false
            }],
            "columns": [
                {
                    "data": "id",
                    render: function (data, type, row, meta) { return meta.row + meta.settings._iDisplayStart + 1; },
                    "autoWidth": true
                },
                //{
                //    "render": function (data, type, full, meta) {
                //        return '<a class="btn-link btn-primary" href="/Commitments/CostBreakdown/' + full.ID + '">Modify</a>';
                //        //return "<a href='#' class='btn-link btn-primary' onclick=selectUpdateRow('" + full.ID + "'); >Update</a>";
                //    }
                //},
                { "data": "Comitmntno", "name": "Comitmntno", "autoWidth": true },
                { "data": "title", "name": "title", "autoWidth": true },
                {
                    "data": "sApprovalID", "name": "sApprovalID", "autoWidth": true,
                    //"data": "CCPSessionDate", "name": "CCPSessionDate", "autoWidth": true,
                    //"render": function (value) {
                    //    if (value === null) return "";
                    //    return moment(value).format('DD-MMM-YYYY');
                    //}
                },
                { "data": "Commitment", "name": "Commitment", "autoWidth": true , className: "text-right"},
                { "data": "CapexOpex", "name": "CapexOpex", "autoWidth": true },
                { "data": "sDirectAllocated", "name": "sDirectAllocated", "autoWidth": true },
                { "data": "UapCode", "name": "UapCode", "autoWidth": true },
                { "data": "UapRollUpCode", "name": "UapRollUpCode", "autoWidth": true },
                { "data": "ActivityType", "name": "ActivityType", "autoWidth": true },
                { "data": "ActivityCode", "name": "ActivityCode", "autoWidth": true },
                { "data": "CostObject", "name": "CostObject", "autoWidth": true },
                { "data": "Activity", "name": "Activity", "autoWidth": true },
                { "data": "FocalPoint", "name": "FocalPoint", "autoWidth": true },
                { "data": "ActivityOwner", "name": "ActivityOwner", "autoWidth": true },
                { "data": "Sponsor", "name": "Sponsor", "autoWidth": true },
                { "data": "Contract", "name": "Contract", "autoWidth": true },
                { "data": "LineManagerFullName", "name": "LineManagerFullName", "autoWidth": true },
            ]
        });
   });;

</script>
        </div>
        <div id="sectionD" class="tab-pane fade">
            
<div class="container-fluid"  style="overflow:auto">
    <br />
    <div style="width:100%; margin:0 auto;">
        <table id="LMSentBudgets" class="table table-striped table-bordered dt-responsive" style="font-size:11px;width:100%" cellspacing="0">
            <thead>
                <tr>
                    <th>S/No</th>
                    <th></th>
                    <th>
                        BCC No.
                    </th>
                    <th>
                        Activity Description
                    </th>
                    <th>
                        Status
                    </th>
                    <th>
                        Commitment(F$)
                    </th>
                    <th>
                        Capex / Opex
                    </th>
                    <th>
                        Direct / Allocated
                    </th>
                    <th>
                        UAP Code
                    </th>
                    <th>
                        UAP Roll Up Code
                    </th>
                    <th>
                        Activity Name
                    </th>
                    <th>
                        Activity Code
                    </th>
                    <th>
                        Cost Object
                    </th>
                    <th>
                        Activity
                    </th>
                    <th>
                        Focal Point
                    </th>
                    <th>
                        Activity Owner
                    </th>
                    <th>
                        Accountable Manager
                    </th>
                    <th>
                        Line Manager
                    </th>
                    <th>
                        Contract
                    </th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript">

   $(document).ready(function ()
   {
       $("#LMSentBudgets").DataTable({
           "aLengthMenu": [[25, 50, 75, -1], [25, 50, 75, "All"]],
            "iDisplayLength": 25,

            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "/Commitments/LoadLMCommitmentsSentForApproval",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs":
            [{
                "width": "30%", "targets": [3],
                "targets": [5], "className": "right",
                "render": $.fn.dataTable.render.number(',', '.', 2), 
                //"visible": false,
                "searchable": false
            }],
            "columns": [
                {
                    "data": "id",
                    render: function (data, type, row, meta) { return meta.row + meta.settings._iDisplayStart + 1; },
                    "autoWidth": true
                },
                {
                    "render": function (data, type, full, meta) {
                       return "<a href='#' class='btn-link btn-primary' onclick=viewApprovedDetailsRow('" + full.ID + "');>View</a>";
                    }
                },
                { "data": "Comitmntno", "name": "Comitmntno", "autoWidth": true },
                { "data": "title", "name": "title", "width":"30%" },
                {
                    "data": "sApprovalID", "name": "sApprovalID", "autoWidth": true,
                    //"data": "CCPSessionDate", "name": "CCPSessionDate", "autoWidth": true,
                    //"render": function (value) {
                    //    if (value === null) return "";
                    //    return moment(value).format('DD-MMM-YYYY');
                    //}
                },
                { "data": "Commitment", "name": "Commitment", "autoWidth": true, className: "text-right" },
                { "data": "CapexOpex", "name": "CapexOpex", "autoWidth": true },
                { "data": "sDirectAllocated", "name": "sDirectAllocated", "autoWidth": true },
                { "data": "UapCode", "name": "UapCode", "autoWidth": true },
                { "data": "UapRollUpCode", "name": "UapRollUpCode", "autoWidth": true },
                { "data": "ActivityType", "name": "ActivityType", "autoWidth": true },
                { "data": "ActivityCode", "name": "ActivityCode", "autoWidth": true },
                { "data": "CostObject", "name": "CostObject", "autoWidth": true },
                { "data": "Activity", "name": "Activity", "autoWidth": true },
                { "data": "FocalPoint", "name": "FocalPoint", "autoWidth": true },  
                { "data": "ActivityOwner", "name": "ActivityOwner", "autoWidth": true },
                { "data": "Sponsor", "name": "Sponsor", "autoWidth": true },
                { "data": "LineManagerFullName", "name": "LineManagerFullName", "autoWidth": true },
                { "data": "Contract", "name": "Contract", "autoWidth": true },
            ]
        });
   });
</script>
        </div>
    </div>
</div>
<br />
<br />
<br />
<br />
<script>
    var ddlOwner = 1;
    var RoleId = 6;
    var ddlAlternate;
    $("#HandOver").click(function () {
        ddlAlternate = $("#ddlUser").val();
        if (ddlAlternate != "--- Select Alternate ---") {
            var url = "/Commitments/HandOverToAlternate";

            $.post(url, { iUserIdOwner: ddlOwner, iUserIdAlternate: ddlAlternate, iRoleId: RoleId }, function (data) {
                window.location.href = "/Commitments/LineManager";
            });
        }
        else {
            alert("Please, select an alternate");
        }
    });

    $(document).ready(function () {
        $('.WideView').on('show.bs.modal', function () {
            $('.modal .modal-body').css('overflow-y', 'auto');
            $('.modal .modal-body').css('max-height', $(window).height() * 0.8);
        });
    });

    function viewDetailsRow(Id) {
        var mymodal = $("#detailsModal");
        $.ajax({
            url: '/Commitments/PresentAction/' + Id, // The method name + paramater
            success: function (data) {
                $('#detailsModalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
                mymodal.modal("show");
            }
        });
    }

    function SendForCCPanel(Id) {
        var url = "/Commitments/CostBreakdown/";
        $.post(url, { Id: Id }, function (data) {
            window.location.href = url + Id;
        });
    }

    function viewApprovedDetailsRow(Id) {
        var mymodal = $("#approvedModal");
        $.ajax({
            url: '/Commitments/ApprovedCommitmentDetails/' + Id, // The method name + paramater
            success: function (data) {
                $('#approvedModalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
                mymodal.modal("show");
            }
        });
    }

    //This Sends for Commitment Control Panel's approval.
    //Accountable Manager's approval is done in the CCPanel meeting.
    function SendForApproval(Id) {
        confirm("Are you sure you want to send for Commitment Control Panel's approval?");
        var url = "/Commitments/SendForApproval/" + Id;

        $.post(url, function (data) {
            window.location.href = '/Commitments/LineManager/';
        });
    }

    //Ability for the line Manager to reject value above Threshold before sending for CCPanel review
    function RejectedByLineManager(Id) {
        var mymodal = $("#declineModal");
        $.ajax({
            url: '/Commitments/PresentAction/' + Id, // The method name + paramater
            success: function (data) {
                $('#declineModalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
                mymodal.modal("show");
            }
        });
    }

    //function editRow(Id) {
    //    var mymodal = $("#editModal");
    //    $.ajax({
    //        url: '/Commitments/EditBudgetBookCommitment/' + Id, // The method name + paramater
    //        success: function (data) {
    //            $('#modalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
    //            mymodal.modal("show");
    //        }
    //    });
    //}

    //function selectRow(Id) {
    //    var mymodal = $("#CreateModal");
    //    $.ajax({
    //        url: '/Commitments/LoadSelectedBBItem/' + Id, // The method name + paramater LoadSelectedBBItem
    //        success: function (data) {
    //            $('#CommitmentWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
    //            mymodal.modal("show");
    //        }
    //    });
    //}

    //function UploadFileRows(Id) {
    //    var mymodal = $("#uploadModal");
    //    $.ajax({
    //        url: '/Commitments/UploadFiles/' + Id, // The method name + paramater
    //        success: function (data) {
    //            $('#uploadModalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
    //            mymodal.modal("show");
    //        }
    //    });
    //}

    ////Source: https://stackoverflow.com/questions/4078553/ajax-call-on-onchange-event-in-mvc
    //$("#ddlCloneCommitment").change(function (event) {
    //    var mymodal = $("#cloneModal");
    //    $.ajax({
    //        url: '/Commitments/EditCommitment/' + $(this).val(), // The method name + paramater
    //        success: function (data) {
    //            $('#cloneModalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
    //            mymodal.modal("show");
    //        }
    //    });
    //});

    //function selectUpdateRow(Id) {
    //    var mymodal = $("#editModal");
    //    $.ajax({
    //        url: '/Commitments/EditBudgetBookCommitment/' + Id, // The method name + paramater LoadSelectedBBItem
    //        success: function (data) {
    //            $('#modalWrapper').html(data); // This should be an empty div where you can inject your new html (the partial view)
    //            mymodal.modal("show");
    //        }
    //    });
    //}

</script>
                </div>
            </div>
        </div>
    </div>


        <div class="footer">
            <!-- Copyright -->
            <div class="footer-copyright text-center py-3">
                © 2019 Copyright:
            </div>
            <!-- Copyright -->
        </div>

        
</body>
</html>--%>


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Commitment Control Pending your Support</title>
</head>

<body>

<h1>Error: Object reference not set to an instance of an object.</h1>Web.BongaCC<hr />/BudgetUploader/Upload<br />QueryString: <hr />Stack Trace<hr />   at Web.BongaCC.Controllers.BudgetUploaderController.Upload(IFormCollection formCollection) in C:\Apps\SHELL\BongaCC\src\Web.BongaCC\Controllers\BudgetUploaderController.cs:line 115<br />   at lambda_method(Closure , Object , Object[] )<br />   at Microsoft.Extensions.Internal.ObjectMethodExecutor.Execute(Object target, Object[] parameters)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()<br />--- End of stack trace from previous location where exception was thrown ---<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()<br />--- End of stack trace from previous location where exception was thrown ---<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|24_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()<br />--- End of stack trace from previous location where exception was thrown ---<br />   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)<br />   at Microsoft.AspNetCore.Builder.RouterMiddleware.Invoke(HttpContext httpContext)<br />   at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context)<br />   at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context)<br />   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.<Invoke>g__Awaited|6_0(ExceptionHandlerMiddleware middleware, HttpContext context, Task task)<table border="1"><tr><td colspan="2">Form collection:</td></tr><tr><td>UploadedFile</td><td></td></tr><tr><td>__RequestVerificationToken</td><td>CfDJ8N-HeJ94Dx1OvIGzb-9NwyNtUGdIobby9HU1__X81ZB3Eylg80NyBMggRE1ikK3yEz4ZKd6gjfWjrpEM5KPXrqiivPhaF8p8G2yszx8TVPCXwa_RYzyVzk9NbY6-3pZnH1Y7Ox9un07BzC9m38_47l6jEsFLZrk4f9Ol5CU0mjuKjxMvp7NP1XsBNbBUTW-MYg</td></tr></table>
</body>
</html>   
